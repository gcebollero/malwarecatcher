{% extends "layout.tmpl" %}


        {% block title %}Search by {{filter}}{% endblock %}
        {% block content %}
<div class="container-fluid">

    <div class="row justify-content-between">
        <div class="col-4">
            <h2>Results for {{filter}}: {{query}}</h2>
        </div>
         {% if filter != "hash" %}
        <div class="col-2">
            <a class="btn btn-secondary" data-toggle="collapse" href="#filters" role="button" aria-expanded="false"
               aria-controls="collapseExample">
                Filters
            </a>
        </div>
        {% else %}
        <div class="col-6">
            <form class="form-row align-items-center" method="get" onsubmit="location.href='/hash/'+this.hash.value;return false">
                <div class="col-1">

                    <label for="partialhash">Search:</label>
                </div>
                <div class="col-11">
    <input type="text" id="partialhash" class="form-control" placeholder="SHA256 value or partial"
           aria-describedby="partialhashHelp" name="hash" {% if query %}value="{{query}}"{% endif %}>
</div>
</form>
        </div>
         {% endif %}
    </div>

    {% if filter != "hash" %}
    <div class="collapse" id="filters">
        <div class="card card-body" style="padding:0">
            <table class="table table-bordered table-sm secondary" style="margin-bottom:0">
                <tbody>
                <tr>
                    {% for key, value in filters.items() %}
                    <td><a href="/{{filter}}/{{key}}">{{key}} <span class="badge badge-secondary badge-pill">{{value}}</span>
                        <span class="sr-only">{{key}} occurrences</span>
                    </a>&nbsp;
                    </td>
                    {% if loop.index is divisibleby 12 %}
                </tr>
                <tr>
                    {% endif %}
                    {% endfor %}
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    <div class="table">
        <table class="table table-striped table-sm" id="results">
            <thead>
            <tr>
                <th>SHA256</th>
                <th>Threat score</th>
                <th>Types</th>
                <th>Architecture</th>
                <th>Scan time</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            {% for item in items %}
            <tr>
                <td><a href="/sha256/{{item['sha256']}}">{{item['sha256']}}</a></td>
                <td>{{item['threat_score']}} ({{item['verdict']}})</td>
                <td>
                    {% if item['type_short'] is not none %}
                    {% for type in item['type_short'] %}
                    <a href="/type/{{type}}" class="badge badge-secondary">{{type}}</a>
                    {% endfor %}
                    {% endif %}
                </td>
                <td>{{item['architecture']}}</td>
                <td>{{item['analysis_start_time']}}</td>
                <td>
                    {% if item['whitelisted'] %}
                    <span class="badge badge-warning">Whitelisted</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
        {% block script %}
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap4.min.js') }}"></script>
<script>
$(document).ready(function() {
    $('#results').DataTable(
    {
        "lengthMenu": [[10, 50, 100, 200, -1], [10, 50, 100, 200, "All"]],
        "ordering": true{% if filter == "hash" %}, "searching": false{% endif %}
    });

} );
</script>
        {% endblock %}