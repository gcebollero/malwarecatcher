{% extends "layout.tmpl" %}


        {% block title %}{{item['sha256']|e}} information{% endblock %}
        {% block content %}
<style>
    .truncate-name {
  width: 13vw;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}


</style>
<div class="container-fluid">
<div class="row justify-content-end">
    <div class="col-3">
        <div class="btn-group" role="group" aria-label="Refresh information options">
  <div class="btn-group" role="group">
    <button id="vt_refresh" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      VirusTotal
    </button>
    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
      <a class="dropdown-item disabled" href="#">Refresh information</a>
    </div>
  </div>
              <div class="btn-group" role="group">
    <button id="ha_refresh" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      HybridAnalysis
    </button>
    <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
      <a class="dropdown-item disabled" href="#">Refresh information</a>
    </div>
  </div>
</div>
    </div>
</div>
<div class="row justify-content-center">
    <div class="col-4">
        <canvas class="my-4 w-100 chartjs-render-monitor" id="leftChart" width="1542" height="651"
                style="display: block; width: 1542px; height: 651px;"></canvas>
    </div>
    <div class="col-4">
        <canvas class="my-4 w-100 chartjs-render-monitor" id="centerChart" width="1542" height="651"
                style="display: block; width: 1542px; height: 651px;"></canvas>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
    <div class="col">
            <h5>Details</h5>
            </div>
    </div>
    <div class="row">


        <table class="table table-sm table-bordered">
            <thead>
            <tr>
                <th scope="col">File name</th>
                <th scope="col">Size in bytes</th>
                <th scope="col">Type</th>
                <th scope="col">Architecture</th>
                <th scope="col">Verdict</th>
                <th scope="col">Whitelisted</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{{item['last_file_name']|e}}</td>
                <td>{{item['size']|int()}}</td>
                <td>{{item['type']|e}}
                    {% for type in item['type_short'] %}
                    <a href="/type/{{type|e}}">{{key|e}}<span class="badge badge-secondary badge-pill">{{type|e}}</span>
                        <span class="sr-only">Type {{key|e}}</span>
                    </a>
                    {% endfor %}
                </td>
                <td>{{item['architecture']|e}}</td>
                <td>{{item['verdict']|e}}</td>
                <td>{{item['whitelisted']|e}}</td>

            </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <thead>
            <tr>
                <th colspan="8">Tags</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                {% if item['tags'] != [] %}
                {% for tag in item['tags'] %}
                <td>{{tag|e}}</td>
                {% if loop.index is divisibleby 8 %}
            </tr>
            <tr>
                {% endif %}
                {% endfor %}
                {% else %}
                <td colspan="8" class="text-muted">No data available</td>
                {% endif %}
            </tr>
            </tbody>
        </table>
        <div class="table-responsive">
        <table class="table table-sm table-bordered">
            <thead>
            <tr>
                <th colspan="6">Other names</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                {% if item['other_file_name'] != [] %}
                {% for name in item['other_file_name'] %}
                <td><p class="truncate-name">{{name|e}}</p></td>
                {% if loop.index is divisibleby 6 %}
            </tr>
            <tr>
                {% endif %}
                {% endfor %}
                {% else %}
                <td colspan="6" class="text-muted">No data available</td>
                {% endif %}
            </tr>
            </tbody>
        </table>
        </div>
    </div>
    <div class="row">
        <div class="row">
            <div class="col">
            <h5>VirusTotal detections</h5>
            </div>
        </div>
        </div>
        <div class="row">
            <div class="col">
                {% if 'scan_date' in item['scanners'][0] %}
            <p><strong>Scan date:</strong> {{item['scanners'][0]['scan_date']|e}} <a
                    href="{{item['scanners'][0]['permalink']|e}}" target="_blank">Scan link</a></p>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <table class="table table-sm table-bordered">
                <thead>
                <tr>
                    <th>AV</th>
                    <th>Result</th>
                    <th>AV</th>
                    <th>Result</th>
                    <th>AV</th>
                    <th>Result</th>
                    <th>AV</th>
                    <th>Result</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    {% if 'scan_date' in item['scanners'][0] %}
                    {% for av in item['scanners'][0]['anti_virus_results'] %}
                    <td>{{av['name']|e}}</td>
                    {% if av['threat_found'] is none %}
                    <td><p class="text-muted">Undetected</p></td>
                    {% else %}
                    <td><p class="text-danger" data-toggle="tooltip" data-placement="top" title="May differ from commecrial off-the-self product">{{av['threat_found']|e}}</p></td>
                    {% endif %}
                    {% if loop.index is divisibleby 4 %}
                </tr>
                <tr>
                    {% endif %}
                    {% endfor %}
                    {% else %}
                    <td colspan="8" class="text-muted">No data available. Please request VirusTotal scan retrieval.</td>
                    {% endif %}
                </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>
{% endblock %}
{% block script %}
<script>
    var leftChart = new Chart(document.getElementById('leftChart'), {
    type: 'doughnut',
    data: {
      datasets: [{
        data: [{{item['scanners'][0].positives|int()}}, {{item['scanners'][0].total|int()-item['scanners'][0].positives|int()}}],
        backgroundColor: [
          '#ff033e',
          '#8db600'
        ],
        labels: ['{{item['scanners'][0].name|e}} positives','{{item['scanners'][0].name|e}} negatives']
      },{
        data: [{{item['scanners'][1].positives|int()}}, {{item['scanners'][1].total|int()-item['scanners'][1].positives|int()}}],
        backgroundColor: [
          '#ff4603',
          '#32b600'
        ],
        labels: ['{{item['scanners'][1].name|e}} positives','{{item['scanners'][1].name|e}} negatives']
      },{
        data: [{{item['scanners'][2].percent|int()}}, {{100-item['scanners'][2].percent|int()}}],
        backgroundColor: [
          '#ffc403',
          '#49ff03'
        ],
        labels: ['{{item['scanners'][2].name|e}} score','']
       },
       ]
    },
    options: {
      responsive: true,
      circumference: Math.PI,
      rotation: Math.PI,
      cutoutPercentage: 10,
      legend: {
        display: false
      },
      title: {
        display: true,
        text: 'Malicious confidence'
      },
      tooltips: {
            callbacks: {
                label: function(tooltipItem, data) {
                    var dataset = data.datasets[tooltipItem.datasetIndex];
                    var index = tooltipItem.index;
                    return dataset.labels[index] + ': ' + dataset.data[index];
                }
            }
        }
    }
  });
var centerChart = new Chart(document.getElementById('centerChart'), {
    type: 'radar',
   data: {
      {% if detections != {} %}
      labels: [{% for detection in detections.keys()%}"{{detection}}"{% if not loop.last %}, {% endif %}{% endfor %}],
      datasets: [
        {
            backgroundColor: "rgb(73,46,203,0.7)",
            fill: true,
            label: ['VirusTotal'],
            data: [{% for detection in detections.values()%}{{detection|e}}{% if not loop.last %}, {% endif %}{% endfor %}]
        }
      ]
      {% endif %}
   },
   options: {
      responsive: true,
      title: {
        display: true,
        text: 'AV categorization'
      },
   },

});

Chart.plugins.register({
	afterDraw: function(chart) {
  	if (chart.data.datasets.length === 0) {
    	// No data is present
      var ctx = chart.chart.ctx;
      var width = chart.chart.width;
      var height = chart.chart.height
      chart.clear();

      ctx.save();
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.font = "16px normal 'Helvetica Nueue'";
      ctx.fillText('No data to display.\nPlease refresh VirusTotal or HybridAnalysis information.', width / 2, height / 2);
      ctx.restore();
    }
  }
});

</script>
{% endblock %}