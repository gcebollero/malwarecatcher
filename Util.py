from logging.handlers import RotatingFileHandler

import Config
import glob
import inspect
import random
import logging


def count_samples():
    return len(glob.glob("{}/*.zip".format(Config.FOLDER)))


def get_sample_list():
    _list = glob.glob("{}/*.zip".format(Config.FOLDER))
    random.shuffle(_list)
    return _list


def write_file(sha256, response):
    with open("{}/{}.zip".format(Config.FOLDER, sha256), 'wb') as fd:
        for chunk in response.iter_content(chunk_size=128):
            fd.write(chunk)


def configure_log(module_name: str) -> logging:
    logger = logging.getLogger(module_name)
    logger.setLevel(logging.DEBUG)
    handler = RotatingFileHandler('malware_catcher.log', maxBytes=10000, backupCount=10)
    formatter = logging.Formatter('%(asctime)s;%(name)s:%(levelname)s: %(message)s')
    handler.setFormatter(formatter)
    logger.addHandler(handler)
    console_handler = logging.StreamHandler()
    console_handler.setFormatter(formatter)
    logger.addHandler(console_handler)
    return logger
